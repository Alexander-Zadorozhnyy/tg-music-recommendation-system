# Music Search API - Краткое описание

## Что это?

**Music Search API** - это RESTful веб-сервис для поиска по базе музыкальных треков. Сервис позволяет искать песни по артистам, названиям, текстам песен и фильтровать результаты по различным параметрам.

## Что он делает?

### Основные возможности

1. **Поиск по музыке**
   - Поиск по артистам (например, "The Beatles")
   - Поиск по названиям треков (например, "Hey Jude")
   - Поиск по текстам песен (например, "love")
   - Поддержка частичных совпадений и опечаток

2. **Фильтрация результатов**
   - По жанру (pop, rock, jazz и т.д.)
   - По году выпуска (диапазон или точное значение)
   - По теме песни (romantic, sadness, violence и т.д.)
   - По аудио-характеристикам (энергия, танцевальность и т.д.)

3. **Получение информации о треках**
   - Полная информация о треке по его ID
   - Метаданные (артист, название, жанр, год)
   - Текст песни
   - Аудио-характеристики

## Как это работает?

### Архитектура

```
Пользователь → FastAPI → SearchService → OpenSearchService → OpenSearch
                ↓
            Ответ с результатами
```

### Процесс поиска

1. **Получение запроса**
   - Пользователь отправляет HTTP запрос (POST или GET)
   - Запрос содержит поисковый запрос и опциональные фильтры

2. **Обработка в SearchService**
   - Валидация запроса через Pydantic модели
   - Подготовка параметров поиска

3. **Поиск в OpenSearchService**
   - Построение поискового запроса для OpenSearch
   - Поиск по нескольким полям одновременно:
     - `artist_name` (имя артиста)
     - `track_name` (название трека)
     - `lyrics` (текст песни)
   - Применение фильтров
   - Использование ngram для частичных совпадений

4. **Ранжирование результатов**
   - OpenSearch использует BM25 алгоритм
   - Результаты сортируются по релевантности
   - Каждый результат получает score (оценку релевантности)

5. **Формирование ответа**
   - Преобразование результатов в Pydantic модели
   - Возврат JSON ответа с результатами

### Технические детали

**Технологии:**

- **FastAPI** - современный Python веб-фреймворк
- **OpenSearch** - поисковый движок (на базе Elasticsearch)
- **Pydantic** - валидация данных
- **Uvicorn** - ASGI сервер

**Особенности поиска:**

- **Ngram поиск** - находит частичные совпадения (например, "beat" найдет "beatles")
- **Fuzzy поиск** - исправляет опечатки
- **Multi-field поиск** - ищет по нескольким полям одновременно
- **BM25 ранжирование** - умное ранжирование по релевантности

## Примеры использования

### Простой поиск

```
POST /search
{
  "query": "love",
  "size": 10
}
```

**Результат:** Найдет все треки, где встречается слово "love" в названии, артисте или тексте песни.

### Поиск с фильтрами

```
POST /search
{
  "query": "love",
  "size": 10,
  "filters": {
    "genre": "pop",
    "release_date": {"gte": 2000}
  }
}
```

**Результат:** Найдет поп-песни про любовь, выпущенные после 2000 года.

### Получение трека по ID

```
GET /search/track/123
```

**Результат:** Вернет полную информацию о треке с ID 123.

## Что внутри?

### Компоненты

1. **Routers** (`app/routers/`)
   - Обработка HTTP запросов
   - Валидация входных данных
   - Формирование ответов

2. **Services** (`app/services/`)
   - `SearchService` - бизнес-логика поиска
   - `OpenSearchService` - работа с OpenSearch

3. **Models** (`app/models/`)
   - Pydantic схемы для валидации
   - Модели запросов и ответов

4. **Config** (`app/config.py`)
   - Настройки подключения
   - Конфигурация приложения

## Данные

Сервис работает с индексом **music_ceds_semantic**, который содержит:

- ~28,000 музыкальных треков
- Информацию об артистах и названиях
- Тексты песен
- Метаданные (жанр, год, тема)
- Аудио-характеристики (энергия, танцевальность и т.д.)

## API Endpoints

- `POST /search` - Поиск через POST запрос
- `GET /search` - Поиск через GET запрос (удобно для тестирования)
- `GET /search/track/{track_id}` - Получить трек по ID
- `GET /health` - Проверка состояния сервиса
- `GET /docs` - Интерактивная документация (Swagger UI)

## Запуск

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск сервиса
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Открыть документацию
# http://localhost:8000/docs
```

## Итого

**Music Search API** - это простой и мощный сервис для поиска по музыкальной базе данных. Он позволяет быстро находить нужные треки по различным критериям и получать детальную информацию о них. Сервис использует современные технологии и обеспечивает высокую производительность поиска.
