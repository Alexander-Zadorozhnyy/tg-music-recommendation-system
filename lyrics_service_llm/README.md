# –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Å–µ–Ω

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ø–∏—Å–∫–∏ –ø–µ—Å–µ–Ω, –Ω–∞—Ö–æ–¥–∏—Ç –∏—Ö —Ç–µ–∫—Å—Ç—ã, –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ **—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—é–º–µ** –∏ **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞** —Å –ø–æ–º–æ—â—å—é **LLM (—á–µ—Ä–µ–∑ Groq API)**.

---

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–∏—Å

- –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ RabbitMQ (`fetch_lyrics`) —Å –ø–µ—Å–Ω—è–º–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ (CSV-—Ñ–∞–π–ª)
- –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:
  - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ API [Genius](https://genius.com/)
  - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ CSV
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—á–∏—â–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ LLM (–º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `llama3-70b`)
- –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç LLM:
  - –æ–¥–Ω–æ **–æ–±–æ–±—â—ë–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (query)** –≤—Å–µ—Ö –ø–µ—Å–µ–Ω (12‚Äì15 —Å–ª–æ–≤)
  - –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Å–Ω–∏:
    - –∫—Ä–∞—Ç–∫–æ–µ **—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ** (2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
    - **5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤** (1‚Äì2 —Å–ª–æ–≤–∞, –±–µ–∑ —Å—Ç–æ–ø-—Å–ª–æ–≤)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤—ã—Ö–æ–¥–Ω—É—é –æ—á–µ—Ä–µ–¥—å `lyrics_responses`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
lyrics_service/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py             # –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ
‚îÇ   ‚îú‚îÄ‚îÄ processor.py        # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ repo_csv.py         # –†–∞–±–æ—Ç–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º CSV-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Ç–µ–∫—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ lyrics_api.py       # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Å–µ–Ω —á–µ—Ä–µ–∑ Genius API
‚îÇ   ‚îú‚îÄ‚îÄ llm_groq.py         # –ó–∞–ø—Ä–æ—Å –∫ LLM —á–µ—Ä–µ–∑ Groq API
‚îÇ   ‚îú‚îÄ‚îÄ rabbit_producer.py  # –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥—å
‚îÇ   ‚îî‚îÄ‚îÄ models.py           # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ songs.csv           # CSV-—Ñ–∞–π–ª —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –ø–µ—Å–µ–Ω
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### `main.py`

- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ RabbitMQ
- –°–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å `fetch_lyrics`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `process_message`

### `processor.py`

- –ò—â–µ—Ç —Ç–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω —á–µ—Ä–µ–∑ `repo_csv.py` –∏ `lyrics_api.py`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –ø–µ—Å–Ω–∏ —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –≤ `llm_groq.analyze_songs_with_llm()`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### `repo_csv.py`

- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω –≤ `data/songs.csv`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `pandas` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∞—Ä—Ç–∏—Å—Ç—É –∏ –Ω–∞–∑–≤–∞–Ω–∏—é

### `lyrics_api.py`

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `lyricsgenius` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–µ—Å–Ω–∏ –ø–æ –∞—Ä—Ç–∏—Å—Ç—É –∏ —Ç—Ä–µ–∫—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GENIUS_ACCESS_TOKEN`

### `llm_groq.py`

- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–π JSON-–∑–∞–ø—Ä–æ—Å –∫ Groq LLM API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `query` –∏ —Å–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω —Å `summary` –∏ `keywords`
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ª—ë–≥–∫—É—é –æ—á–∏—Å—Ç–∫—É —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

---

## –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ –∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

### üì® –í—Ö–æ–¥ (`fetch_lyrics`)

```json
{
  "id": "req_summary_test",
  "user_id": "user42",
  "song_credits": [
    {"artist": "Radiohead", "track": "Vegetable"},
    {"artist": "Adele", "track": "Hello"}
  ]
}
```

### üì§ –í—ã—Ö–æ–¥ (`lyrics_responses`)

```json
{
  "id": "req_summary_test",
  "user_id": "user42",
  "query": "longing for past love and regret over past mistakes",
  "songs_texts": [
    {
      "artist": "Radiohead",
      "track": "Vegetable",
      "summary": "A person struggles with fear and control, surrounded by domestic violence and desperation.",
      "keywords": ["fear", "control", "desperation"]
    },
    {
      "artist": "Adele",
      "track": "Hello",
      "summary": "A person reaches out to an ex-lover, apologizing for past mistakes and struggling with regret and longing.",
      "keywords": ["regret", "longing", "apology"]
    }
  ]
}
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- `Python 3.10+`
- API-–∫–ª—é—á–∏:
  - `GROQ_API_KEY` ‚Äî –¥–æ—Å—Ç—É–ø –∫ Groq LLM
  - `GENIUS_ACCESS_TOKEN` ‚Äî –¥–æ—Å—Ç—É–ø –∫ Genius API

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

```env
GROQ_API_KEY=sk-...
GROQ_MODEL=llama3-70b
GROQ_BASE_URL=https://api.groq.com/openai/v1

GENIUS_ACCESS_TOKEN=your_genius_token
CSV_PATH=/app/data/songs.csv
QUEUE_IN=fetch_lyrics
QUEUE_OUT=lyrics_responses
```

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
docker compose up --build
```

RabbitMQ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:15672](http://localhost:15672)
(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ª–æ–≥–∏–Ω `guest`, –ø–∞—Ä–æ–ª—å `guest`)

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º LLM
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤

---
